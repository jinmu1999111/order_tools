{% extends "layout.html" %}
{% block title %}ã‚­ãƒƒãƒãƒ³ä¼ç¥¨{% endblock %}
{% block content %}
<div class="container-fluid">
    <h1 class="mb-4">ğŸ³ ã‚­ãƒƒãƒãƒ³ä¼ç¥¨ (èª¿ç†å¾…ã¡)</h1>
    <div id="pending-orders-grid" class="row">
        </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // æ³¨æ–‡ã‚’æä¾›æ¸ˆã¿ã«ã™ã‚‹
    async function serveOrder(tableId, orderId) {
        await fetch('/api/order/serve', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ table_id: tableId, order_id: orderId })
        });
        updateKitchenStatus();
    }

    // ã‚­ãƒƒãƒãƒ³ã®çŠ¶æ³ã‚’æ›´æ–°
    async function updateKitchenStatus() {
        const response = await fetch('/api/kitchen_status');
        const data = await response.json();
        const grid = document.getElementById('pending-orders-grid');
        grid.innerHTML = '';

        if (data.pending_orders.length === 0) {
            grid.innerHTML = '<p class="text-muted">æ–°ã—ã„æ³¨æ–‡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
            return;
        }

        data.pending_orders.forEach(order => {
            const col = document.createElement('div');
            col.className = 'col-lg-3 col-md-4 col-sm-6 mb-4';
            col.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <div class="card-header fw-bold">${order.table_name}</div>
                    <div class="card-body">
                        <h5 class="card-title">${order.item.name}</h5>
                        <p class="card-text text-muted">å—ä»˜: ${order.timestamp}</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-success w-100" onclick="serveOrder('${order.table_id}', ${order.id})">
                            æä¾›OK
                        </button>
                    </div>
                </div>
            `;
            grid.appendChild(col);
        });
    }

    // åˆæœŸè¡¨ç¤ºã¨è‡ªå‹•æ›´æ–°
    document.addEventListener('DOMContentLoaded', updateKitchenStatus);
    setInterval(updateKitchenStatus, 5000); // 5ç§’ã”ã¨ã«æ›´æ–°
</script>
{% endblock %}