{% extends "layout.html" %}
{% block title %}キッチン伝票{% endblock %}
{% block content %}
<div class="container-fluid">
    <h1 class="mb-4">🍳 キッチン伝票 (調理待ち)</h1>
    <div id="pending-orders-grid" class="row">
        </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function serveOrder(orderId) {
        await fetch('/api/order/serve', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ order_id: orderId })
        });
        updateKitchenStatus();
    }

    async function updateKitchenStatus() {
        const response = await fetch('/api/kitchen_status');
        const data = await response.json();
        const grid = document.getElementById('pending-orders-grid');
        grid.innerHTML = '';

        if (data.pending_orders.length === 0) {
            grid.innerHTML = '<div class="col-12"><p class="text-center text-muted fs-4 mt-5">新しい注文はありません。</p></div>';
            return;
        }

        data.pending_orders.forEach(order => {
            const col = document.createElement('div');
            col.className = 'col-lg-3 col-md-4 col-sm-6 mb-4';
            col.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <div class="card-header fw-bold fs-5">${order.table_name}</div>
                    <div class="card-body">
                        <h5 class="card-title fs-4">${order.item_name}</h5>
                        <p class="card-text text-muted">受付: ${order.timestamp}</p>
                    </div>
                    <div class="card-footer p-2">
                        <button class="btn btn-success w-100 fw-bold" onclick="serveOrder(${order.id})">
                            提供OK
                        </button>
                    </div>
                </div>
            `;
            grid.appendChild(col);
        });
    }

    document.addEventListener('DOMContentLoaded', updateKitchenStatus);
    setInterval(updateKitchenStatus, 5000); // 5秒ごとに更新
</script>
{% endblock %}